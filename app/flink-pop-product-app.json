{
    "apiVersion": "cmf.confluent.io/v1",
    "kind": "FlinkApplication",
    "metadata": {
       "name": "popularproduct-app"
    },
    "spec": {
       "image": "flink-popular-product-job:latest",
       "flinkConfiguration": {
          "metrics.reporter.prom.factory.class": "org.apache.flink.metrics.prometheus.PrometheusReporterFactory",
          "metrics.reporter.prom.port": "9249-9250",
          "taskmanager.numberOfTaskSlots": "1",
          "state.savepoints.dir": "s3://clickeventpopularproduct/savepoints",
          "state.checkpoints.dir": "s3://clickeventpopularproduct/checkpoints",
          "s3.endpoint": "http://minio-svc.minio-dev:9000",
          "s3.path.style.access": "true",
          "s3.access-key": "minioadmin",
          "s3.secret-key": "minioadmin",
          "execution.checkpointing.interval": "10000",
          "rest.flamegraph.enabled": "true"
       },
       "flinkVersion": "v1_19",
       "serviceAccount": "flink",
       "podTemplate": {
          "metadata": {
             "name": "pod-template"
          },
          "spec": {
             "volumes": [
                {
                   "name": "flink-data",
                   "emptyDir": {}
                }
             ],
             "containers": [
                {
                   "name": "flink-main-container",
                   "env": [
                      {
                         "name": "ENABLE_BUILT_IN_PLUGINS",
                         "value": "flink-s3-fs-hadoop-1.19.1-cp1.jar;flink-s3-fs-presto-1.19.1-cp1.jar"
                      },
                      {
                        "name": "KAFKA_BOOTSTRAP_SERVERS",
                        "value": "kafka.confluent.svc.cluster.local:9071"
                      },
                      {
                        "name": "SCHEMA_REGISTRY_URL",
                        "value": "http://schemaregistry.confluent.svc.cluster.local:8081"
                      },
                      {
                        "name": "TOPIC_INPUT_KAFKA",
                        "value": "clickstream"
                      },
                      {
                        "name": "TOPIC_OUTPUT_KAFKA",
                        "value": "popularproduct"
                      }
                   ],
                   "volumeMounts": [
                      {
                         "name": "flink-data",
                         "mountPath": "/opt/flink-data"
                      }
                   ]
                }
             ]
          }
       },
       "job": {
          "jarURI": "local:///lib/job.jar",
          "parallelism": 1,
          "state": "running",
          "upgradeMode": "stateless"
       },
       "jobManager": {
          "resource": {
             "cpu": 1,
             "memory": "1048m"
          }
       },
       "taskManager": {
          "resource": {
             "cpu": 1,
             "memory": "1048m"
          }
       }
    }
 }